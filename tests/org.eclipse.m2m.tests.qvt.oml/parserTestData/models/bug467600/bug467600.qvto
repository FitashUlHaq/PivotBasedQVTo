modeltype ECORE "strict" uses "http://www.eclipse.org/emf/2002/Ecore";
	

transformation bug467600(in e : ECORE);

main() {

	// test template version of Model::createEmptyModel()
	//
	do {
		var e1 : ECORE := ECORE.createEmptyModel();
		assert fatal (e1.oclIsTypeOf(ECORE));
		assert fatal (e1.objects()->size() = 0);
		 
		var e2 : ECORE := e.createEmptyModel();
		assert fatal (e2.oclIsTypeOf(ECORE));
		assert fatal (e2.objects()->size() = 0);
		 
		var e3 : ECORE := e.copy();
		assert fatal (e3.oclIsTypeOf(ECORE));
		assert fatal (e3.objects()->size() = 11);
	};


	// test various Model.objects*()
	//
	do {
		var v : Set(Element) := e.objects();
		assert fatal (v->size() = 11);
	};
	do {
		var v : Set(OclAny) := e.objects();
		assert fatal (v->size() = 11);
	};
	
	do {
		var v : Set(ECORE::EPackage) := e.objectsOfType(EPackage);
		assert fatal (v->size() = 1); 
	};
	
	do {
		var v : Set(EModelElement) := e.objectsOfKind(EClassifier);
		assert fatal (v->size() = 3);
	};
	
	
	var pack : EPackage := e.objectsOfType(EPackage)->any(true);
	

	// test various Element.subobjects*()
	//
	do {
		var v : Set(Stdlib::Element) := pack.subobjects();
		assert fatal (v->size() = 3);
	};

	do {
		var v : Set(oclstdlib::OclAny) := pack.allSubobjects();
		assert fatal (v->size() = 10);
	};

	do {
		var v : Set(Element) := pack.subobjectsOfKind(EClassifier);
		assert fatal (v->size() = 3);
	};

	do {
		var v : Set(Element) := pack.subobjectsOfType(EEnum);
		assert fatal (v->size() = 1);
	};

	do {
		var v : Set(Element) := pack.allSubobjectsOfKind(ETypedElement);
		assert fatal (v->size() = 3);
	};

	do {
		var v : Set(Element) := pack.allSubobjectsOfType(EAttribute);
		assert fatal (v->size() = 2);
		
		var attr : Element := v->asSequence()->at(1);
		var attr2 : Element := v->asSequence()->at(2);

		assert fatal(pack.allSubobjectsOfType(EAttribute)->includes(attr));
		assert fatal(not pack.allSubobjectsOfType(EAttribute)->excludes(attr));
		assert fatal(pack.allSubobjectsOfType(EAttribute)->count(attr) = 1);

		assert fatal(pack.allSubobjectsOfType(EAttribute)->includesAll(Sequence{attr, attr2}));
		assert fatal(not pack.allSubobjectsOfType(EAttribute)->excludesAll(Sequence{attr, attr2}));

		assert fatal(pack.allSubobjectsOfType(EAttribute) = Set{attr, attr2});
		assert fatal(not (pack.allSubobjectsOfType(EAttribute) <> Set{attr, attr2}));
	};


	// test various allInstances()
	//
	do {
		var v : Set(EModelElement) := e.allInstances(ENamedElement);
		assert fatal (v->size() = 9);
	};
	
	do {
		var v : Set(EModelElement) := ENamedElement.allInstances();
		assert fatal (v->size() = 9);
	};
	
	do {	
		var v : Set(EModelElement) := pack.allInstances(ENamedElement);
		assert fatal (v->size() = 8);
	};


	// test various dump() and repr()
	//
	do {
		var o : Stdlib::Object := null; 
		o.dump();
		dump(o);
		log(o.repr());
	};
	
	do {	
		var e : Stdlib::Element := pack;
		e.dump();
		dump(e);
		log(e.repr());
	};
	
	do {	
		var u : ECORE::ENamedElement := pack;
		u.dump();
		dump(u);
		log(u.repr());
	};
	
	do {	
		var c : Collection(Element) := Sequence{pack, pack};
		c->dump();
		dump(c);
		log(c->repr());
	};	
	
	do {	
		var c : Collection(String) := Dict{1="a", 2="b"};
		c->dump();
		dump(c);
		log(c->repr());
	};	
	
	do {	
		var c : Dict(Integer, String) := Dict{1="a", 2="b"};
		c->dump();
		dump(c);
		log(c->repr());
	};	
	
	do {	
		var c : List(String) := List{"a", "b"};
		c->dump();
		dump(c);
		log(c->repr());
	};	
	
	do {	
		var c : Tuple(s:String) := Tuple{s="a"};
		c.dump();
		dump(c);
		log(c.repr());
	};	
	
	do {	
		invalid.dump();
		dump(null);
		dump(invalid);
		log(invalid.repr());
	};	
	
}
